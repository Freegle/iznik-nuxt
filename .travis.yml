dist: trusty
branches:
  only: app
env:
  global:
  - ANDROID_API_LEVEL=28
  - ANDROID_BUILD_TOOLS_VERSION=28.0.3
  - TERM=dumb
  - secure: k757wZO6GgzqINhfjN7DHx8Y48RC2cb2XLSkRahTIxNUwfUnIOIR5liAztLYPzq7IZJkvQe1o2DMSMlEc3U26qvtMyV3M+3FzBRXHzlwYMAW1S5JX90cHQXVI1n77TfqV5Qjt4x0lczia4+hj9u7pLg4wbOtZ4MC8B8S4FKXJdVnBwRW80x6f21HUCfUMNlXFqbihf3NTevv2zzEaytFcjx3IT06CzkKSpIiQ/zyi8iGlqU+k3Bx3brhGmXmAvVK1FG3H8WRHPTi87SDiqLitQQv/RmwHyRwne4Ok8FnMmCynFjFugdn1uyVRPtV16R3hMsPAFacc6RRzcyujLu+JIVdxs0tDiCAO7VnDPlDIy/M5sxnrRll+qMz9d/C9aFrd83OYKQ3Uts9rlJw5BoUPIH7oez3rky1rzRc9YxgQPoFDGxyRgtyLda1eugxzDBiCGzOv2O6//szGJAbiQwkd0D4+T3+JKiXZ3E/PjKJ0sBg+q8k2zJCi+SbsD/Z5bOJ/uVBRvSFEDSCF41zKRiMioj06/GzNN2gmtM/PilblQfgXaWa7GxzHBkT+JWUXmI5jmuovz2qAu5T7apPXka/UDw4JJkBQtktdecVUnD1ruIu7tAhjJZEU5GOTJwXXGohtJquZ9qRPnnAfEpI//vqre7X+4hgx4d/zgmm/JAWJXs=
  - secure: oTRLRVoflU7QY2qJXFhGZrhJDzVMJBqtiffUPOiQvADWr6M3OwbsbyAQLbinRww4fz6m2OX6HXZJ7xOQ5w1xlPJBVt8qSwwefIgS6Iw0ZS6Pk1upqUIygzTaZDQROz/8PpZfmD/GDa+9trm376iCr8u709aWopTW2GE5dpZ8t0dQReIkfV5pF9O1CUMUiTlfHN9Sz0ljMnxTshpxo4LdfgsJTUqMYgH6fZN5fOxSH5VAoZ744+GDHDnOGF3ncw9lp6q0bw2fxl96jneYOZaloCADlxmvKfzFYCEkm/ECoJOqvqjN6ClB41jm8IlDC12r91Lz7TuQxAs/CPqmSjc6Ayreo2NvdggwF2x870jwghwc1H8aupPaWvv1nenZbHXsDZGMxXtlvLODbPPVHpBorQ4OvXoidIZnkgvLOuq8YIlnTwmFdxYhjaE7iV3XdWDE2GbvJrlt6m45k5OXqqz4lqsP08rdGI2aYMZsLjGMbEf5X4eTS6jeISiApWiDie1DCvf6GEOA1D146r6nFrvloEwpl6NAlsgsMoGxdJXdAQNSfqjzq9ZZI63TKfgOmQDYvVFr0GjTdKh1nKVtgUJ12w0mhSVjNRPqf267mwQkMpJl7ANzFrZecuVMkawDggXeTGqRVcCXCvso0atiQv7mN1iMIXD71LhLezT7S2milOI=
  - secure: yoKdyQEyxO5YJqyOB838uxqzykT9A3jWTdwKvcHiuQuJR7301fYtJ5KgNIsLVZ4ZZph78Ap/sAt9sKDXF7J3lZpx8JIRZ7Vf0u5A80Xr/zpmX5alVveY9EYzUlIp/O7tCY500t/w64izS44Xpf3jatuGMI9cdxGV5e8mbTkOc5HOi47ZhUUiPChwIhzJEneEKceNV7rKYBi4Jv2I6mANs3ltWeON/Yh777LNNyw8pqrAbo2mv6oae5O/GWrtGwOVscKv+0MteOMHBpnIkkqDUfIIocTbWOs+ZZAdaDulzEj2ZkObk1sKO22KcUa3Nd+FJ/0kyILLbwJ5JyIuXc9ubLjrbKMEd3YT7vhmIbhFa5KIQ7PPCyOYbXjtmozZOhvRsSSHA1+CYKykY5mMt9wWyQyVkZ0QNGki4KkDmRbOc6Gu+DnPKL5Jtlmf7X99w5J55BnA8nZR7ulV0cpyS2skxFWjJ3j9H2H/1MuDqdW7D4dD+jmdIIN2WnvP3WHOjQiSZeb36949AZF2wDvO5XP7ihaDH7KFUBPpVNcJnGBsVEAU5ZWSTlipAYOCHkVyPXQIaMpphS8/b61gJB2qnQ2H4/gIkvKEGqmCjM3OopoKhbXyCeLwUF//uKCu+ImeLMJFFipOTb7EWJ58FBJm98JRC1O0E+jEx73JFi4gUmp3hK0=
  - secure: OIY/nL8ERD7sRLFJq390oNCA3INh22vrOpo0hLeKYyJMhlDPXJsD2CK+cEi8wY4gNH9j8l7ZCmb0lQ12rkZZAkXLyyva412RzQ+Iu+Vq5G4ISjodIw9dXKkXrDm9pWAvr+gWBU1t2Yj3q+0HHG48VQIBh0xJnhO3S6VzRoKLHiU6wUi3vuBsq+XF6S5HwMT6abJgtjV1hqeCHw0LXk9nqCVTTpSaktMRV9Jnr0QCNJLiD/coumrfQO09hvnxaSCg7c2ahRNs+C9N4oXVVr8ZJvbsXoFUYhIf6Y5E5NmaqxuMn6KRe1TBBIAZ02qOJJn75lklUgMlD7LqEoEpCQtfIBual7M5NneCDHPaJfeMp9LCqv5J0iDeODFsJqQiwMyYjTY0H3Jui3nmL4BNhzbHn84B9pQ4kjpS+SWUIK9Dx0AWJrPE/nioLaVp4b2FgWAXsau9jxkpUK3O6QSDu3/4lpz/IGHl9swLZiVAUyHO43lDDur9cUd8WA2uKh3z9GxBc65K05CtDGGC4/aP0HDdE0AKCjaE6dzECMtx5j+ws/1iMkXxf8fBkhVmG+Qc8Tr4A2+Wpz9ytOFbYBwuyTB12FtgwCSkktWT+f8BRa964MgRQp1n454XZEE7jtuwhZbqxjT+b2h+Na+VEZK8Q0fQFQIbFkrI3hp6BbeEz+CY+lE=
  matrix:
  - nodejs_version=12
language: android
jdk:
- oraclejdk8
android:
  components:
  - tools
  - build-tools-$ANDROID_BUILD_TOOLS_VERSION
  - android-$ANDROID_API_LEVEL
  - extra
  licenses:
  - android-sdk-preview-license-.+
  - android-sdk-license-.+
  - google-gdk-license-.+
before_install:
- openssl aes-256-cbc -K $encrypted_a57fb8741d35_key -iv $encrypted_a57fb8741d35_iv
  -in mobile/app-secrets.tar.enc -out mobile/app-secrets.tar -d
- tar xvf mobile/app-secrets.tar
- nvm install $nodejs_version
- npm install -g cordova
- npm install -g q
- npm install
- node --version
- npm --version
- gradle --version
script:
- npm run fdapp
- mkdir ../iznik-nuxt-app
- cd ../iznik-nuxt-app
- ln -s ../iznik-nuxt/mobile/freegle/android/config.xml config.xml
- ln -s ../iznik-nuxt/mobile/freegle/android/package.json package.json
- ln -s ../iznik-nuxt/mobile/freegle/icons icons
- ln -s ../iznik-nuxt/mobile/freegle/package-assets package-assets
- ln -s ../iznik-nuxt/mobile/freegle/scripts scripts
- cp ../iznik-nuxt/google-services.json google-services.json
- ln -s ../iznik-nuxt/dist www
- cordova platform rm android
- cordova platform add android
- cordova build -- --keystore="../iznik-nuxt/android-chrisphdcccom.keystore" --storePassword="$storepass" --password=="$keypass" --alias="$keystorealias"
#- "./gradlew assembleRelease"
#- jarsigner -verbose -sigalg SHA1withRSA -storepass $storepass -keypass $keypass -digestalg SHA1 -keystore mobile/android-chrisphdcccom.keystore ../iznik-nuxt-app/platforms/android/app/build/outputs/apk/debug/app-debug.apk $keystorealias
#- zipalign -v 4 ../iznik-nuxt-app/platforms/android/app/build/outputs/apk/debug/app-debug.apk PATH_TO_/MY_RELEASE.apk- cd ../iznik-nuxt
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
  - "$HOME/.android/build-cache"
before_deploy:
  - git config --local user.name "$gitusername"
  - git config --local user.email "$gitemail"
  - export TRAVIS_TAG=${TRAVIS_TAG:-$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)}
  - git tag $TRAVIS_TAG
#deploy:
#  provider: releases
#  api_key:
#    secure: S+1f7ZdQf6C/dH8Cx0i/gtX1hko6xRE9my5j4Kvp9vc5K/frbQGWEM8eqKOmVAvVs+eoN6sFO+tv6mUyRZ4pFzOxxLlVSd0taEgf9NuIxrmclMbAa9f6TpA0g5QTZH0ARYZg5pr9gX4HpKlYlkoO0Roac8VK6d1yO2FFK5eN+KO3+NPCvSA0vIJip4BYTBKCzmDC/AmZWhlBaQSZUVpv5kiItiPO8jM5a5FE+KmDZ0bPBr6t41CFHTivJ5iKt+AfIkALa8er4WMteXCLI8yRt6T7jut8oIDGx5awCtve4v5LL+gTh39XSTdSsEyUCmP395W1CxXT6HjvIIVc4yvqmZ+3KEdM6MuayZZsHbcooqtEC5hht/OQ147eEpV0MZ+Ebn2as0wFcy4783KF9HxX3RppyA4ptVj91baBl99s1c8i11pti7i45dT82l5D71CDhwAfhtMG9CDfPvkHcb9q9J1jN8pYmi39h9iDJS7O7a1XbePJIM33yUrO9uq2w5Id9aIWBlyECMiPNZe1PqTlJlUzGbeSkvoKvj1TzUyiBCYMrJMQoRwAaaeZbR2NkeXGgKwCmMAAsQGHs0hbEDnIrRyp/0L+jyvkiZEiC0ffKYRdu5P2VOGi7DkDu0SCeChUW7dndzXLckMpPE7o92EWXkzXJmzqIt7JuTq08+ngyJU=
#  file: "../iznik-nuxt-app/platforms/android/app/build/outputs/apk/debug/app-debug.apk"
#  on:
#    repo: Freegle/iznik-nuxt
#    branch: app
