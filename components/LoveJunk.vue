<template>
  <a v-if="show" @click="click">
    <b-card-img v-observe-visibility="visible" :src="src" fluid class="clickme" />
  </a>
</template>
<script>
import * as turf from '@turf/turf'

export default {
  props: {
    variant: {
      type: String,
      required: true
    }
  },
  data: function() {
    return {
      shown: false
    }
  },
  computed: {
    src() {
      return this.variant === 'mobile'
        ? 'lovejunk/mobile.jpg'
        : 'lovejunk/desktop.jpg'
    },
    show() {
      // We want to show the ad if the user's location is within the area LoveJunk cover.
      if (this.me && (this.me.lat || this.me.lng)) {
        // const point = turf.point([-0.1281, 51.508])
        // const point = turf.point([this.me.lng, this.me.lat])
        // Disabled for now
        const point = turf.point([1, 2])
        const poly = turf.polygon([
          [
            [0.5149561877144171, 51.54932587512362],
            [0.4710108752144171, 51.60906438228973],
            [0.2457911486519171, 51.68405284100286],
            [0.11120862912066709, 51.71809750897523],
            [0.006838511933167091, 51.73170820445779],
            [-0.1634495740043329, 51.74531480252034],
            [-0.3749363904105829, 51.716395883916896],
            [-0.5369847302543329, 51.655094730543595],
            [-0.6001561169730829, 51.60991722066963],
            [-0.6386082654105829, 51.598829071998544],
            [-0.6990330700980829, 51.58005834366799],
            [-0.7347386365043329, 51.52797166080751],
            [-0.7429783825980829, 51.483950395581104],
            [-0.7264988904105829, 51.45529237035627],
            [-0.7100193982230829, 51.41077260913653],
            [-0.6962864880668329, 51.36963893136491],
            [-0.7045262341605829, 51.32503570973297],
            [-0.7045262341605829, 51.2391382271629],
            [-0.7429783825980829, 51.149634383290426],
            [-0.7924168591605829, 51.08066692940952],
            [-0.6495945935355829, 51.04269094381574],
            [-0.4243748669730829, 51.021963638477935],
            [-0.1332371716605829, 50.98393949870788],
            [0.03155775021441709, 50.987397526563065],
            [0.09747571896441709, 51.035782872063685],
            [0.1743800158394171, 51.08756830739748],
            [0.2183253283394171, 51.139295827202105],
            [0.2128321642769171, 51.20817580196807],
            [0.2018458361519171, 51.256330575500726],
            [0.2045924181831671, 51.31130290651464],
            [0.2293116564644171, 51.36106476028019],
            [0.3336817736519171, 51.42105025101969],
            [0.3611475939644171, 51.46556000080451],
            [0.4133326525581671, 51.46727104797439],
            [0.4215723986519171, 51.50660742624628],
            [0.4792506213081671, 51.52199068524558],
            [0.5149561877144171, 51.54932587512362]
          ]
        ])

        return turf.booleanPointInPolygon(point, poly)
      }

      return false
    }
  },
  methods: {
    visible() {
      if (!this.shown) {
        this.shown = true

        this.$api.bandit.shown({
          uid: 'lovejunk',
          variant: this.variant
        })
      }
    },
    async click() {
      await this.$api.bandit.chosen({
        uid: 'lovejunk',
        variant: this.variant
      })

      window.open('https://www.lovejunk.com/rubbish-clearance/')
    }
  }
}
</script>
