<template>
  <a v-if="show" @click="click">
    <b-card-img v-observe-visibility="visible" :src="src" fluid class="clickme" />
  </a>
</template>
<script>
import turfpoint from 'turf-point'
import turfpolygon from 'turf-polygon'
import turfbooleanPointInPolygon from '@turf/boolean-point-in-polygon'

export default {
  props: {
    variant: {
      type: String,
      required: true
    }
  },
  data: function() {
    return {
      shown: false
    }
  },
  computed: {
    src() {
      return this.variant === 'mobile'
        ? '/lovejunk/mobile.jpg'
        : '/lovejunk/desktop.jpg'
    },
    show() {
      // We want to show the ad if the user's location is within the area LoveJunk cover.
      if (this.me && (this.me.lat || this.me.lng)) {
        // const point = turfpoint([-0.1281, 51.508])
        const point = turfpoint([this.me.lng, this.me.lat])

        const poly = turfpolygon([
          [
            [0.5259425158394171, 51.55103377944621],
            [0.4710108752144171, 51.60906438228973],
            [0.2457911486519171, 51.68405284100286],
            [0.1853663439644171, 51.77591466938604],
            [0.10022230099566709, 51.859109269060724],
            [-0.06182603884808291, 52.008134540614854],
            [-0.2238743786918329, 52.046158167552356],
            [-0.3145115857230829, 52.18235464351779],
            [-0.5177586560355829, 52.27950324518672],
            [-0.6578343396293329, 52.236632670883374],
            [-0.9654515271293329, 52.11789238977283],
            [-1.1254399304496454, 52.06916787179091],
            [-1.065701771269958, 51.973039646875485],
            [-1.0828679089652704, 51.865681880684654],
            [-1.132993031035583, 51.76486710968381],
            [-0.9791844372855829, 51.64657411596832],
            [-0.8555882458793329, 51.52540848176331],
            [-0.8171360974418329, 51.427900728570876],
            [-0.7841771130668329, 51.31988639029965],
            [-0.7484715466605829, 51.230539642688214],
            [-0.7374852185355829, 51.19268677825382],
            [-0.7402318005668329, 51.17202664482575],
            [-0.7429783825980829, 51.149634383290426],
            [-0.7924168591605829, 51.08066692940952],
            [-0.9187596325980829, 51.00814028442958],
            [-0.9352391247855829, 50.89740506471821],
            [-0.9874241833793329, 50.78640589354414],
            [-0.7910435681449579, 50.72906873818545],
            [-0.7093327527152704, 50.780328010049814],
            [-0.5613606457816767, 50.79899328189555],
            [-0.3254979138480829, 50.805502669940786],
            [-0.1977818493949579, 50.82285660488892],
            [-0.06457262087933291, 50.80203110916665],
            [0.01233167599566709, 50.79161487915983],
            [0.05353040646441709, 50.852343497457625],
            [0.06657667111285459, 50.90433374668936],
            [0.09610242794879209, 50.95453586060892],
            [0.1441676134956671, 51.028873770302134],
            [0.1743800158394171, 51.08756830739748],
            [0.2183253283394171, 51.139295827202105],
            [0.2128321642769171, 51.20817580196807],
            [0.2018458361519171, 51.256330575500726],
            [0.1524073595894171, 51.31130290651464],
            [0.2073390002144171, 51.35934973342131],
            [0.3336817736519171, 51.42105025101969],
            [0.3611475939644171, 51.46556000080451],
            [0.4215723986519171, 51.50660742624628],
            [0.4792506213081671, 51.52199068524558],
            [0.5259425158394171, 51.55103377944621]
          ]
        ])

        console.log(
          'Check ',
          turfbooleanPointInPolygon,
          turfbooleanPointInPolygon(point, poly)
        )
        return turfbooleanPointInPolygon(point, poly)
      }

      return false
    }
  },
  methods: {
    visible() {
      if (!this.shown) {
        this.shown = true

        this.$api.bandit.shown({
          uid: 'lovejunk',
          variant: this.variant
        })
      }
    },
    async click() {
      await this.$api.bandit.chosen({
        uid: 'lovejunk',
        variant: this.variant
      })

      window.open('https://www.lovejunk.com/rubbish-clearance/')
    }
  }
}
</script>
